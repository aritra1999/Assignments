{% extends 'base/base.html' %}
{% load static %}
{% block extrahead %}
    <link rel="stylesheet" href="{% static 'css/question.css' %}">
{% endblock extrahead %}
{% block content %}
    <div class="main_cont">
        <div class="topBar">
            <a href="#" onclick="goBack()" class="back"><img src="{% static 'Illustrations/backArrow.svg' %}" alt="" class="backArrow"></a>
            <h1 class="questionHead">{{ question.assignment }} - {{ question.slug }}</h1>
        </div>
        <div class="partition">
            <div class="left">
                <div class="cta">
                    <div class="heads">
                        <h1 class="questionTitle">{{ question.title }}</h1>
                        <h2 class="additionDate">Added on: {{ question.timestamp }}</h2>
                    </div>
                    <a href="#" class="submissions">View Submissions</a>
                </div>
                <div class="questionBody">
                    <div class="questionPart">
                        <h1 class="problemTag">Problem Statement</h1>
                        <p class="questionBody">
                            It is important for researchers to write many high quality academic papers. Jorge has recently discovered a way to measure how impactful a researcher's papers are: the H-index. The H-index score of a researcher is the largest integer h such that the researcher has h papers with at least h citations each. Jorge has written N papers in his lifetime. The i-th paper has Ai citations. The number of citations that each paper has will never change after it is written. Please help Jorge determine his H-index score after each paper he wrote.
                        </p>
                    </div>
                    <div class="questionPart">
                        <h1 class="problemTag">Input</h1>
                        <p class="questionBody">
                            The first line of the input gives the number of test cases, T. T test cases follow. Each test case begins with a line containing N, the number of papers Jorge wrote. The second line contains N integers. The i-th integer is Ai, the number of citations the i-th paper has.
                        </p>
                    </div>
                    <div class="questionPart">
                        <h1 class="problemTag">Output</h1>
                        <p class="questionBody">
                            For each test case, output one line containing Case #x: y, where x is the test case number (starting from 1) and y is a space-separated list of integers. The i-th integer is the H-index score after Jorge wrote his i-th paper.
                        </p>
                    </div>
                </div>
            </div>
            <div class="right">
                <div class="top">

                </div>
                <div class="bottom">
                    <div class="idk">
                        <p class="allowed">Allowed language : <span>Python</span></p>
                        <a href="#" class="submit">Submit</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
{% block extrafoot %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script>
        $("#clearVerdict").click(function () {
            $("#verdict").empty();
        });

        function submit_code() {
            let code = document.getElementById('code').value;
            let language = document.getElementById('language').value;
            let csrf = document.getElementsByName('csrfmiddlewaretoken')[0].value;

            $("#processing").css({"display": "block"});
            $("#verdict").empty();
            $.ajax({
                method: 'POST',
                url: '/dashboard/submit/{{ question.slug }}',
                data: {
                    language: language,
                    code: code,
                    csrfmiddlewaretoken: csrf,
                }
            })
            .done(function (data, status) {
                $("#processing").css({"display": "none"});

                if (data.status === "success") {
                    for (let i = 1; i <= 5; i++) {
                        $("#verdict").append(i + "." + data['verdict' + i] + " Time taken: " + data['time' + i] + " Memory used: " + data['memory' + i] + " Score: " + data['score' + i] + "<br>");
                    }
                    $("#verdict").append("Total Score: " + data['totalscore'] + "/100<br><br>" );
                    if(data['totalscore'] > 20){
                        $("#verdict").append("Pass");
                    }else{
                        $("#verdict").append("Fail");
                    }

                } else {
                    $('#verdict').text(data['error']['message'] + "<br>");
                    $('#verdict').append(data['error']['output']);
                }
            })
            .fail(function (data, status) {
                $('#verdict').text(data);
            });
        }

        window.goBack = function (e){
            let defaultLocation = "http://localhost:8000/dashboard/";
            let oldHash = window.location.hash;

            history.back();
            let newHash = window.location.hash;
            if(
                newHash === oldHash &&
                (typeof(document.referrer) !== "string" || document.referrer  === "")
            ){
                window.setTimeout(function(){
                    window.location.href = defaultLocation;
                },1000);
            }
            if(e){
                if(e.preventDefault)
                    e.preventDefault();
                if(e.preventPropagation)
                    e.preventPropagation();
            }
            return false;
        }
    </script>
{% endblock extrafoot %}